<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>滚动小球-globalCompositeOperation</title>
</head>
<body>
  <canvas id="canvas" style="border: 1px solid #aaa;"></canvas>
  <script>
    let balls = [];
    window.onload = function() {
      const canvas = document.getElementById('canvas');
      canvas.width = 1200;
      canvas.height = 800;
      const cxt = canvas.getContext('2d');

      for(let i = 0; i < 100; i++) {
        const R = Math.floor(Math.random() * 255);
        const G = Math.floor(Math.random() * 255);
        const B = Math.floor(Math.random() * 255);
        const radius = Math.random() * 50 + 20;
        let aBall = {
          color: `rgb\(${R}, ${G} ,${B}\)`,
          radius: radius,
          x: Math.random() * (canvas.width - 2 * radius) + radius,
          y: Math.random() * (canvas.height - 2 *radius) + radius,
          vx: (Math.random() * 5 + 5) * Math.pow(-1, Math.floor(Math.random() * 100)),
          vy: (Math.random() * 5 + 5) * Math.pow(-1, Math.floor(Math.random() * 100)),
        };
        balls[i] = aBall;
      }

      setInterval(() => {
        draw(cxt);
        update(canvas.width, canvas.height);
      }, 50)
    }

    // 绘制小球
    function draw(cxt) {
      cxt.clearRect(0, 0, cxt.canvas.width, cxt.canvas.height);
      for (let i = 0; i < balls.length; i++) {
        cxt.globalCompositeOperation = 'xor';
        cxt.fillStyle = balls[i].color;
        cxt.beginPath();
        cxt.arc(balls[i].x, balls[i].y, balls[i].radius, 0, 2 * Math.PI);
        cxt.closePath();
        cxt.fill();
      }
    }
    // 更新
    function update(canvasWidth, canvasHeight) {
      for (let i = 0; i < balls.length; i++) {
        balls[i].x += balls[i].vx;
        balls[i].y += balls[i].vy;

        // 碰撞检测
        // 要求小球全部在画布内，条件：
        // 1.球左边界 > 0，球右边界 < 画布宽
        if (balls[i].x - balls[i].radius <= 0) {
          balls[i].vx = -balls[i].vx;
          balls[i].x = balls[i].radius;
        }
        if (balls[i].x + balls[i].radius >= canvasWidth) {
          balls[i].vx = -balls[i].vx;
          balls[i].x = canvasWidth - balls[i].radius;
        }

        // 2.球上边界 > 0，球下边界 < 画布高
        if (balls[i].y - balls[i].radius <= 0) {
          balls[i].vy = -balls[i].vy;
          balls[i].y = balls[i].radius;
        }
        if (balls[i].y + balls[i].radius >= canvasHeight) {
          balls[i].vy = -balls[i].vy;
          balls[i].y = canvasHeight - balls[i].radius;
        }
      }
    }
  </script>
</body>
</html>